services:
  playwright:
    image: mcr.microsoft.com/playwright:v1.56.0-jammy
    working_dir: /app
    volumes:
      - ../..:/app
      - playwright_node_modules:/app/node_modules
    network_mode: host
    environment:
      - CI=${CI:-false}
    ipc: host
    entrypoint: /bin/sh -c
    command: 
      - |
        npm install -g pnpm@10.8.1
        pnpm install --frozen-lockfile
        npx playwright test -c libs/core/playwright.config.ts

  playwright-ui:
    image: mcr.microsoft.com/playwright:v1.56.0-jammy
    working_dir: /app
    volumes:
      - ../..:/app
      - playwright_node_modules:/app/node_modules
    network_mode: host
    environment:
      - CI=false
    ipc: host
    entrypoint: /bin/sh -c
    command:
      - |
        npm install -g pnpm@10.8.1
        pnpm install --frozen-lockfile
        npx playwright test -c libs/core/playwright.config.ts --ui --ui-port=8077 --ui-host=localhost

  update-snapshots:
    image: mcr.microsoft.com/playwright:v1.56.0-jammy
    working_dir: /app
    volumes:
      - ../..:/app
      - playwright_node_modules:/app/node_modules
    network_mode: host
    environment:
      - CI=false
    ipc: host
    entrypoint: /bin/sh -c
    command:
      - |
        npm install -g pnpm@10.8.1
        pnpm install --frozen-lockfile
        npx playwright test -c libs/core/playwright.config.ts --update-snapshots

volumes:
  playwright_node_modules:
