"use strict";var lt=Object.defineProperty;var ut=(o,t,n)=>t in o?lt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var E=(o,t,n)=>(ut(o,typeof t!="symbol"?t+"":t,n),n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("vue"),u=require("vue-demi"),W=(o,t)=>{if(document.caretPositionFromPoint){const n=document.caretPositionFromPoint(o,t);return n?{offsetNode:n.offsetNode,offset:n.offset,getClientRect(){return n.getClientRect()}}:null}else{const n=document.caretRangeFromPoint(o,t);return n?{offsetNode:n.startContainer,offset:n.startOffset,getClientRect(){return n.getClientRects()[0]}}:null}},ct=function(o,t){return o.start<=t.start&&o.end>=t.start},dt=function(o,t){return o.start<=t.end&&o.end>=t.end};class pt{constructor(t,n){E(this,"props");E(this,"editAnnotationState");E(this,"componentClasses",u.computed(()=>["annotated-text","theme-"+this.props.theme,"annotated-text--render-"+this.props.render,this.editAnnotationState.action?"action--active action--"+this.editAnnotationState.action:null,this.props.showLabels?"annotated-text--show-labels":null].filter(n=>n)));E(this,"wordPartClasses",t=>["token-segment","token-segment--m"+this.maxAnnotationWeight(t.annotations)]);E(this,"annotationGutterClasses",(t,n)=>{const e=[(t==null?void 0:t.class)??"",this.props.style.weightClass+((t==null?void 0:t.weight)??0)];return ct(n,t)&&e.push(this.props.style.startClass),dt(n,t)&&e.push(this.props.style.endClass),e});E(this,"annotationClasses",(t,n,e,i)=>{const a=[(t==null?void 0:t.class)??"",(t==null?void 0:t.tmpClass)??"",this.props.style.weightClass+((t==null?void 0:t.weight)??0)];return(t==null?void 0:t.start)===n&&a.push(this.props.style.startClass),(t==null?void 0:t.end)===e&&a.push(this.props.style.endClass),this.editAnnotationState.annotation&&t.id===this.editAnnotationState.annotation.id&&t!==this.editAnnotationState.annotation&&a.push(this.props.style.transitioningClass),this.editAnnotationState.annotation&&t===this.editAnnotationState.annotation&&a.push(this.props.style.shadowClass),this.props.hoveredAnnotations.includes(t.id)&&a.push(this.props.style.hoveredClass),this.props.selectedAnnotations.includes(t.id)&&a.push(this.props.style.activeClass),i&&a.push("create-anno-text"),a});E(this,"maxAnnotationWeight",function(t){return t.reduce((n,e)=>Math.max(n,Number((e==null?void 0:e.weight)??0)),0)});this.props=t,this.editAnnotationState=n}}const ft={key:0,class:"annotation-slot annotation-slot--before"},ht={key:1},mt={key:2,class:"text"},gt={key:3,class:"annotation-slot annotation-slot--after"},vt=s.defineComponent({__name:"RecursiveAnnotatedTokenPartText",props:{componentId:{},text:{},start:{},end:{},annotations:{default:()=>[]},annotationClassHandler:{type:Function,default:()=>[]},wordPartStart:{},allowEdit:{type:Boolean},allowCreate:{type:Boolean},mouseDownHandler:{},mouseMoveHandler:{}},setup(o){const t=o,n=u.computed(()=>t.annotations[0]);return(e,i)=>{var p,d,g,f;const a=s.resolveComponent("RecursiveAnnotatedTokenPartText",!0);return s.openBlock(),s.createElementBlock(s.Fragment,null,[e.start===((p=s.unref(n))==null?void 0:p.start)?(s.openBlock(),s.createElementBlock("span",ft,[s.renderSlot(e.$slots,"annotation-before",{annotation:s.unref(n)})])):s.createCommentVNode("",!0),e.annotations.length?(s.openBlock(),s.createElementBlock("span",{key:1,class:s.normalizeClass(t.annotationClassHandler(s.unref(n),e.start,e.end,t.allowCreate)),onMousedown:i[2]||(i[2]=s.withModifiers(h=>t.mouseDownHandler(h,{startOffset:e.wordPartStart,annotation:s.unref(n),action:"move"}),["stop"])),onMousemove:i[3]||(i[3]=s.withModifiers(h=>t.mouseMoveHandler(h,{startOffset:e.wordPartStart,annotation:s.unref(n)}),["stop"]))},[e.start===((d=s.unref(n))==null?void 0:d.start)?(s.openBlock(),s.createElementBlock("span",{key:0,class:"handle handle--start",onMousedown:i[0]||(i[0]=s.withModifiers(h=>t.mouseDownHandler(h,{startOffset:e.wordPartStart,annotation:s.unref(n),action:"moveStart"}),["stop"]))},null,32)):s.createCommentVNode("",!0),s.createVNode(a,{"component-id":e.componentId,annotations:e.annotations.slice(1),text:e.text,start:e.start,end:e.end,"allow-edit":e.allowEdit,"word-part-start":e.wordPartStart,"annotation-class-handler":t.annotationClassHandler,"mouse-down-handler":t.mouseDownHandler,"mouse-move-handler":t.mouseMoveHandler},{"annotation-before":s.withCtx(h=>[s.renderSlot(e.$slots,"annotation-before",{annotation:h.annotation})]),"annotation-after":s.withCtx(h=>[s.renderSlot(e.$slots,"annotation-after",{annotation:h.annotation})]),_:3},8,["component-id","annotations","text","start","end","allow-edit","word-part-start","annotation-class-handler","mouse-down-handler","mouse-move-handler"]),e.annotations[0].label?(s.openBlock(),s.createElementBlock("label",ht,s.toDisplayString(e.annotations[0].label),1)):s.createCommentVNode("",!0),e.end===((g=e.annotations[0])==null?void 0:g.end)?(s.openBlock(),s.createElementBlock("span",{key:2,class:"handle handle--end",onMousedown:i[1]||(i[1]=s.withModifiers(h=>t.mouseDownHandler(h,{startOffset:e.wordPartStart,annotation:s.unref(n),action:"moveEnd"}),["stop"]))},null,32)):s.createCommentVNode("",!0)],34)):(s.openBlock(),s.createElementBlock("span",mt,s.toDisplayString(e.text),1)),e.end===((f=s.unref(n))==null?void 0:f.end)?(s.openBlock(),s.createElementBlock("span",gt,[s.renderSlot(e.$slots,"annotation-after",{annotation:s.unref(n)})])):s.createCommentVNode("",!0)],64)}}}),Et=["onMousemove"],wt={class:"text"},yt=["onMousedown","onMousemove"],St={key:0},Ct=["onMousedown"],bt=s.defineComponent({__name:"AnnotatedLine",props:{componentId:{},line:{},wordPartClasses:{type:Function,default:()=>[]},render:{default:"nested"},annotationClasses:{type:Function,default:()=>[]},allowEdit:{type:Boolean},allowCreate:{type:Boolean},mouseDownHandler:{},mouseMoveHandler:{}},setup(o){const t=o,n=u.computed(()=>t.render==="nested"),e=u.computed(()=>t.render==="flat");function i(){const a=["text"];return t.allowCreate&&a.push("create-anno-text"),a}return(a,p)=>(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(a.line.words,d=>(s.openBlock(),s.createElementBlock("span",{key:d.text,class:"token"},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(d.parts,g=>(s.openBlock(),s.createElementBlock("span",{key:g.text,class:s.normalizeClass(a.wordPartClasses(g)),onMousemove:f=>t.mouseMoveHandler(f,{startOffset:g.start})},[s.unref(e)?(s.openBlock(),s.createElementBlock(s.Fragment,{key:0},[s.createElementVNode("span",wt,s.toDisplayString(g.text),1),(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(g.annotations,f=>(s.openBlock(),s.createElementBlock("span",{key:f.id,class:s.normalizeClass(a.annotationClasses(f,g.start,g.end,t.allowCreate)),onMousedown:h=>t.mouseDownHandler(h,{startOffset:g.start,annotation:f,action:"move"}),onMousemove:h=>t.mouseMoveHandler(h,{startOffset:g.start,annotation:f})},[f.label?(s.openBlock(),s.createElementBlock("label",St,s.toDisplayString(f.label),1)):s.createCommentVNode("",!0)],42,yt))),128))],64)):s.createCommentVNode("",!0),s.unref(n)?(s.openBlock(),s.createElementBlock(s.Fragment,{key:1},[g.annotations.length?(s.openBlock(),s.createBlock(vt,{key:0,"component-id":t.componentId,text:g.text,start:g.start,end:g.end,"allow-edit":a.allowEdit,"allow-create":a.allowCreate,"word-part-start":g.start,annotations:g.annotations.sort((f,h)=>h.weight-f.weight),"annotation-class-handler":a.annotationClasses,"mouse-down-handler":t.mouseDownHandler,"mouse-move-handler":t.mouseMoveHandler},{"annotation-before":s.withCtx(f=>[s.renderSlot(a.$slots,"annotation-before",{annotation:f.annotation})]),"annotation-after":s.withCtx(f=>[s.renderSlot(a.$slots,"annotation-after",{annotation:f.annotation})]),_:2},1032,["component-id","text","start","end","allow-edit","allow-create","word-part-start","annotations","annotation-class-handler","mouse-down-handler","mouse-move-handler"])):(s.openBlock(),s.createElementBlock("span",{key:1,class:s.normalizeClass(i()),onMousedown:f=>t.mouseDownHandler(f,{startOffset:g.start})},s.toDisplayString(g.text),43,Ct))],64)):s.createCommentVNode("",!0)],42,Et))),128))]))),128))}});/*!
 * pinia v2.2.2
 * (c) 2024 Eduardo San Martin Morote
 * @license MIT
 */let $;const z=o=>$=o,Nt=process.env.NODE_ENV!=="production"?Symbol("pinia"):Symbol();function D(o){return o&&typeof o=="object"&&Object.prototype.toString.call(o)==="[object Object]"&&typeof o.toJSON!="function"}var H;(function(o){o.direct="direct",o.patchObject="patch object",o.patchFunction="patch function"})(H||(H={}));const j=typeof window<"u";function st(o,t){for(const n in t){const e=t[n];if(!(n in o))continue;const i=o[n];D(i)&&D(e)&&!u.isRef(e)&&!u.isReactive(e)?o[n]=st(i,e):u.isVue2?u.set(o,n,e):o[n]=e}return o}const at=()=>{};function Z(o,t,n,e=at){o.push(t);const i=()=>{const a=o.indexOf(t);a>-1&&(o.splice(a,1),e())};return!n&&u.getCurrentScope()&&u.onScopeDispose(i),i}function P(o,...t){o.slice().forEach(n=>{n(...t)})}const kt=o=>o(),K=Symbol(),q=Symbol();function X(o,t){o instanceof Map&&t instanceof Map?t.forEach((n,e)=>o.set(e,n)):o instanceof Set&&t instanceof Set&&t.forEach(o.add,o);for(const n in t){if(!t.hasOwnProperty(n))continue;const e=t[n],i=o[n];D(i)&&D(e)&&o.hasOwnProperty(n)&&!u.isRef(e)&&!u.isReactive(e)?o[n]=X(i,e):o[n]=e}return o}const _t=process.env.NODE_ENV!=="production"?Symbol("pinia:skipHydration"):Symbol(),At=new WeakMap;function Ot(o){return u.isVue2?!At.has(o):!D(o)||!o.hasOwnProperty(_t)}const{assign:A}=Object;function tt(o){return!!(u.isRef(o)&&o.effect)}function et(o,t,n,e){const{state:i,actions:a,getters:p}=t,d=n.state.value[o];let g;function f(){!d&&(process.env.NODE_ENV==="production"||!e)&&(u.isVue2?u.set(n.state.value,o,i?i():{}):n.state.value[o]=i?i():{});const h=process.env.NODE_ENV!=="production"&&e?u.toRefs(u.ref(i?i():{}).value):u.toRefs(n.state.value[o]);return A(h,a,Object.keys(p||{}).reduce((y,C)=>(process.env.NODE_ENV!=="production"&&C in h&&console.warn(`[ðŸ]: A getter cannot have the same name as another state property. Rename one of them. Found with "${C}" in store "${o}".`),y[C]=u.markRaw(u.computed(()=>{z(n);const b=n._s.get(o);if(!(u.isVue2&&!b._r))return p[C].call(b,b)})),y),{}))}return g=Y(o,f,t,n,e,!0),g}function Y(o,t,n={},e,i,a){let p;const d=A({actions:{}},n);if(process.env.NODE_ENV!=="production"&&!e._e.active)throw new Error("Pinia destroyed");const g={deep:!0};process.env.NODE_ENV!=="production"&&!u.isVue2&&(g.onTrigger=c=>{f?b=c:f==!1&&!r._hotUpdating&&(Array.isArray(b)?b.push(c):console.error("ðŸ debuggerEvents should be an array. This is most likely an internal Pinia bug."))});let f,h,y=[],C=[],b;const B=e.state.value[o];!a&&!B&&(process.env.NODE_ENV==="production"||!i)&&(u.isVue2?u.set(e.state.value,o,{}):e.state.value[o]={});const M=u.ref({});let R;function O(c){let l;f=h=!1,process.env.NODE_ENV!=="production"&&(b=[]),typeof c=="function"?(c(e.state.value[o]),l={type:H.patchFunction,storeId:o,events:b}):(X(e.state.value[o],c),l={type:H.patchObject,payload:c,storeId:o,events:b});const w=R=Symbol();u.nextTick().then(()=>{R===w&&(f=!0)}),h=!0,P(y,l,e.state.value[o])}const V=a?function(){const{state:l}=n,w=l?l():{};this.$patch(k=>{A(k,w)})}:process.env.NODE_ENV!=="production"?()=>{throw new Error(`ðŸ: Store "${o}" is built using the setup syntax and does not implement $reset().`)}:at;function F(){p.stop(),y=[],C=[],e._s.delete(o)}const x=(c,l="")=>{if(K in c)return c[q]=l,c;const w=function(){z(e);const k=Array.from(arguments),U=[],J=[];function rt(_){U.push(_)}function it(_){J.push(_)}P(C,{args:k,name:w[q],store:r,after:rt,onError:it});let L;try{L=c.apply(this&&this.$id===o?this:r,k)}catch(_){throw P(J,_),_}return L instanceof Promise?L.then(_=>(P(U,_),_)).catch(_=>(P(J,_),Promise.reject(_))):(P(U,L),L)};return w[K]=!0,w[q]=l,w},T=u.markRaw({actions:{},getters:{},state:[],hotState:M}),I={_p:e,$id:o,$onAction:Z.bind(null,C),$patch:O,$reset:V,$subscribe(c,l={}){const w=Z(y,c,l.detached,()=>k()),k=p.run(()=>u.watch(()=>e.state.value[o],U=>{(l.flush==="sync"?h:f)&&c({storeId:o,type:H.direct,events:b},U)},A({},g,l)));return w},$dispose:F};u.isVue2&&(I._r=!1);const r=u.reactive(process.env.NODE_ENV!=="production"||process.env.NODE_ENV!=="production"&&process.env.NODE_ENV!=="test"&&j?A({_hmrPayload:T,_customProperties:u.markRaw(new Set)},I):I);e._s.set(o,r);const m=(e._a&&e._a.runWithContext||kt)(()=>e._e.run(()=>(p=u.effectScope()).run(()=>t({action:x}))));for(const c in m){const l=m[c];if(u.isRef(l)&&!tt(l)||u.isReactive(l))process.env.NODE_ENV!=="production"&&i?u.set(M.value,c,u.toRef(m,c)):a||(B&&Ot(l)&&(u.isRef(l)?l.value=B[c]:X(l,B[c])),u.isVue2?u.set(e.state.value[o],c,l):e.state.value[o][c]=l),process.env.NODE_ENV!=="production"&&T.state.push(c);else if(typeof l=="function"){const w=process.env.NODE_ENV!=="production"&&i?l:x(l,c);u.isVue2?u.set(m,c,w):m[c]=w,process.env.NODE_ENV!=="production"&&(T.actions[c]=l),d.actions[c]=l}else process.env.NODE_ENV!=="production"&&tt(l)&&(T.getters[c]=a?n.getters[c]:l,j&&(m._getters||(m._getters=u.markRaw([]))).push(c))}if(u.isVue2?Object.keys(m).forEach(c=>{u.set(r,c,m[c])}):(A(r,m),A(u.toRaw(r),m)),Object.defineProperty(r,"$state",{get:()=>process.env.NODE_ENV!=="production"&&i?M.value:e.state.value[o],set:c=>{if(process.env.NODE_ENV!=="production"&&i)throw new Error("cannot set hotState");O(l=>{A(l,c)})}}),process.env.NODE_ENV!=="production"&&(r._hotUpdate=u.markRaw(c=>{r._hotUpdating=!0,c._hmrPayload.state.forEach(l=>{if(l in r.$state){const w=c.$state[l],k=r.$state[l];typeof w=="object"&&D(w)&&D(k)?st(w,k):c.$state[l]=k}u.set(r,l,u.toRef(c.$state,l))}),Object.keys(r.$state).forEach(l=>{l in c.$state||u.del(r,l)}),f=!1,h=!1,e.state.value[o]=u.toRef(c._hmrPayload,"hotState"),h=!0,u.nextTick().then(()=>{f=!0});for(const l in c._hmrPayload.actions){const w=c[l];u.set(r,l,x(w,l))}for(const l in c._hmrPayload.getters){const w=c._hmrPayload.getters[l],k=a?u.computed(()=>(z(e),w.call(r,r))):w;u.set(r,l,k)}Object.keys(r._hmrPayload.getters).forEach(l=>{l in c._hmrPayload.getters||u.del(r,l)}),Object.keys(r._hmrPayload.actions).forEach(l=>{l in c._hmrPayload.actions||u.del(r,l)}),r._hmrPayload=c._hmrPayload,r._getters=c._getters,r._hotUpdating=!1})),process.env.NODE_ENV!=="production"&&process.env.NODE_ENV!=="test"&&j){const c={writable:!0,configurable:!0,enumerable:!1};["_p","_hmrPayload","_getters","_customProperties"].forEach(l=>{Object.defineProperty(r,l,A({value:r[l]},c))})}return u.isVue2&&(r._r=!0),e._p.forEach(c=>{if(process.env.NODE_ENV!=="production"&&process.env.NODE_ENV!=="test"&&j){const l=p.run(()=>c({store:r,app:e._a,pinia:e,options:d}));Object.keys(l||{}).forEach(w=>r._customProperties.add(w)),A(r,l)}else A(r,p.run(()=>c({store:r,app:e._a,pinia:e,options:d})))}),process.env.NODE_ENV!=="production"&&r.$state&&typeof r.$state=="object"&&typeof r.$state.constructor=="function"&&!r.$state.constructor.toString().includes("[native code]")&&console.warn(`[ðŸ]: The "state" must be a plain object. It cannot be
	state: () => new MyClass()
Found in store "${r.$id}".`),B&&a&&n.hydrate&&n.hydrate(r.$state,B),f=!0,h=!0,r}function Vt(o,t,n){let e,i;const a=typeof t=="function";if(typeof o=="string")e=o,i=a?n:t;else if(i=o,e=o.id,process.env.NODE_ENV!=="production"&&typeof e!="string")throw new Error('[ðŸ]: "defineStore()" must be passed a store id as its first argument.');function p(d,g){const f=u.hasInjectionContext();if(d=(process.env.NODE_ENV==="test"&&$&&$._testing?null:d)||(f?u.inject(Nt,null):null),d&&z(d),process.env.NODE_ENV!=="production"&&!$)throw new Error(`[ðŸ]: "getActivePinia()" was called but there was no active Pinia. Are you trying to use a store before calling "app.use(pinia)"?
See https://pinia.vuejs.org/core-concepts/outside-component-usage.html for help.
This will fail in production.`);d=$,d._s.has(e)||(a?Y(e,t,i,d):et(e,i,d),process.env.NODE_ENV!=="production"&&(p._pinia=d));const h=d._s.get(e);if(process.env.NODE_ENV!=="production"&&g){const y="__hot:"+e,C=a?Y(y,t,i,d,!0):et(y,A({},i),d,!0);g._hotUpdate(C),delete d.state.value[y],d._s.delete(y)}if(process.env.NODE_ENV!=="production"&&j){const y=u.getCurrentInstance();if(y&&y.proxy&&!g){const C=y.proxy,b="_pStores"in C?C._pStores:C._pStores={};b[e]=h}}return h}return p.$id=e,p}function Bt(o){if(u.isVue2)return u.toRefs(o);{o=u.toRaw(o);const t={};for(const n in o){const e=o[n];(u.isRef(e)||u.isReactive(e))&&(t[n]=u.toRef(o,n))}return t}}var N=(o=>(o.IDLE="idle",o.SELECTING="selecting",o.UPDATING="updating",o.CREATING="creating",o.START_SELECT="start-selecting",o.START_CREATE="start-creating",o))(N||{});class Dt{constructor(){E(this,"state");E(this,"payload");this.state="idle",this.payload=null}reset(){this.state="idle",this.payload=null}}class Rt{constructor(t){E(this,"action");E(this,"handlePosition");E(this,"annotation");E(this,"origAnnotation");E(this,"origEnd");E(this,"origStart");E(this,"newEnd");E(this,"newStart");E(this,"updating",!1);E(this,"userState");this.userState=t,this.resetUpdate()}resetUpdate(){this.action=null,this.handlePosition=null,this.annotation=null,this.origAnnotation=null,this.origEnd=null,this.origStart=null,this.newEnd=null,this.newStart=null,this.updating=!1,this.userState.state="idle",this.updating=!1}startUpdating(t,n,e,i=null,a=null,p,d){this.action=t,this.handlePosition=n,this.origAnnotation=e,this.annotation=JSON.parse(JSON.stringify(e)),this.annotation.tmpClass="",this.origEnd=i,this.origStart=a,this.newEnd=p,this.newStart=d}confirmStartUpdating(){this.userState.state="updating",this.updating=!0,this.confirmUpdate()}confirmUpdate(){this.updating&&(this.annotation.start=this.newStart,this.annotation.end=this.newEnd)}}class Tt{constructor(){E(this,"hoveredAnnotations");E(this,"mouseEvent");this.hoveredAnnotations=[],this.mouseEvent=null}}class Pt{constructor(t){E(this,"newEnd");E(this,"newStart");E(this,"annotation");E(this,"creating");E(this,"userState");this.userState=t,this.resetCreating()}resetCreating(){this.creating=!1,this.annotation=null,this.newEnd=null,this.newStart=null,this.creating=!1,this.userState.state="idle"}startCreating(t){this.creating=!0,this.newStart=t,this.newEnd=t}initAnnotation(t){this.annotation=t,this.annotation.start=this.newStart,this.annotation.end=this.newEnd}updateCreating(){this.annotation.start=this.newStart,this.annotation.end=this.newEnd}}const Mt=o=>Vt(`stateObjects-${o}`,()=>{const t=s.ref(new Dt),n=s.ref(new Rt(t.value)),e=s.ref(new Pt(t.value)),i=s.ref(new Tt);return{updateState:n,createState:e,hoverState:i,userState:t}});function xt(o){const t=[[0,[]]];for(const e of o){let i=t.length-1;for(;i>=0;--i){const p=t[i];if(p[0]<=e[0]){p[0]<e[0]&&(t.splice(i+1,0,[e[0],t[i][1].slice()]),i+=1);break}}let a=t.length-1;for(;a>=0;--a){const p=t[a];if(p[0]<=e[1]){p[0]<e[1]&&(t.splice(a+1,0,[e[1],p[1].slice()]),a+=1);break}}for(let p=i;p<a;++p)t[p][1].push(e[2])}const n=[];for(let e=0;e<t.length-1;++e)t[e][1].length>0&&n.push([t[e][0],t[e+1][0],t[e][1]]);return n}const It=1,nt=(o,t)=>{const n=o[0]<t[0]?o:t,e=n==o?t:o;return n[1]<e[0]?null:[e[0],n[1]<e[1]?n[1]:e[1]]};class Ut{constructor(t,n,e){E(this,"props");E(this,"editState");E(this,"createState");E(this,"allAnnotations",u.computed(()=>{this.props.debug&&console.log("** refresh annotations");let t=JSON.parse(JSON.stringify(this.props.annotations));return this.editState.annotation&&t.push(this.editState.annotation),this.createState.annotation&&t.push(this.createState.annotation),t=u.reactive(t),t=t.filter(n=>(n==null?void 0:n.visible)!==!1),t}));E(this,"gutterAnnotations",u.computed(()=>{this.props.debug&&console.log("** refresh gutterAnnotations **");const t=this.allAnnotations.value.filter(n=>n.target==="gutter");return this.props.debug&&console.log(t),t}));E(this,"prepareRanges",t=>{this.props.debug&&console.log("** prepare ranges for_annotations **"),this.props.debug&&console.log(t);const n=t.filter(e=>e.target==="span");return this.props.autoAnnotationWeights&&(this.calculateAnnotationWeights(n),this.calculateGutterAnnotationWeights(this.gutterAnnotations.value)),this.props.debug&&console.log("** weighted span annotations **"),this.props.debug&&console.log(n),this.props.debug&&console.log("** weighted gutter annotations **"),this.props.debug&&console.log(this.gutterAnnotations.value),t.map(e=>[Math.max(0,e.start-this.props.annotationOffset),e.end+It-this.props.annotationOffset,e])});E(this,"calculateAnnotationWeights",function(t){const n=function(i,a){return i.start-a.start===0?a.end-i.end:i.start-a.start};t=t.sort(n);const e=[];t.forEach(i=>{let a=0;for(;;){if(!(e!=null&&e[a])){i.weight=a,e[a]=i;return}if(i.start>e[a].end){i.weight=a,e[a]=i;return}a++}})});E(this,"calculateGutterAnnotationWeights",t=>{const n=function(a,p){const d=a.end-a.start,g=p.end-p.start;return d-g};t=t.sort(n);let e=0;t.forEach(function(a){a.weight=e,e++});const i=Math.max(...this.gutterAnnotations.value.map(a=>a.weight));t.forEach(function(a){a.weight=i-a.weight})});E(this,"flattenedRanges",u.computed(()=>{let t=this.prepareRanges(this.allAnnotations.value);return this.props.lines.forEach(n=>{t.push([n.start,n.end+1,null]);const e=n.text.split(" ");let i=0;e.forEach((a,p)=>{const d=n.start+i,g=p<e.length-1?d+a.length+1:d+a.length;t.push([d,g+1,null]),i+=a.length+1})}),t=t.sort((n,e)=>Number(n[0])-Number(e[0])===0?Number(n[1])-Number(e[1]):Number(n[0])-Number(e[0])),xt(t)}));E(this,"createAnnotatedWord",t=>{let n=this.flattenedRanges.value.filter(a=>nt([a[0],a[1]-1],[t.start,t.end]));const e=this.props.display;n=n.map(function(a){return a[2]=a[2].filter(p=>p).filter(p=>(p==null?void 0:p.target)===e).sort((p,d)=>Number(p==null?void 0:p.start)>Number(d==null?void 0:d.start)?1:-1),a});const i=n.map(a=>({start:a[0],end:a[1]-1,text:typeof t.text=="string"?t.text.substring(a[0]-t.start,a[1]-t.start):"",annotations:a[2]}));return{start:t.start,end:t.end,text:t.text,parts:i}});E(this,"createAnnotatedLine",t=>{let n=[];const e=this.flattenedRanges.value.filter(f=>nt([f[0],f[1]-1],[t.start,t.end]));for(const f of e)f[2].filter(h=>h).filter(h=>(h==null?void 0:h.target)==="gutter").sort((h,y)=>Number(h==null?void 0:h.weight)<Number(y==null?void 0:y.weight)?-1:1).forEach(h=>n.push(h));n=[...new Set(n)];const i=Math.max(...this.gutterAnnotations.value.map(f=>f.weight));for(let f=0;f<=i;f++)if(!(n.filter(y=>y.weight===f).length!=0)){const y={start:t.start,end:t.start,target:"gutter",class:"annotation annotation--gutter-spacer",weight:f};n.push(y)}n.sort((f,h)=>Number(f==null?void 0:f.weight)<Number(h==null?void 0:h.weight)?-1:1);const a=[];let p=0;const d=t.text.split(" ");d.forEach((f,h)=>{a.push({start:t.start+p,end:t.start+p+f.length,text:h<d.length-1?f+" ":f}),p+=h<d.length-1?f.length+1:f.length});const g=[];return a.forEach(f=>{g.push(this.createAnnotatedWord(f))}),{start:t.start,end:t.end,words:g,gutter:{text:t.gutter,annotations:n}}});E(this,"annotatedLines",u.computed(()=>{const t=this.props.lines.map(n=>this.createAnnotatedLine(n));return this.props.debug&&console.log(`** annotated lines (component ${this.props.componentId}) **`),this.props.debug&&console.log(t),t}));this.props=t,this.editState=n,this.createState=e}}var S=[];for(var Q=0;Q<256;++Q)S.push((Q+256).toString(16).slice(1));function Lt(o,t=0){return(S[o[t+0]]+S[o[t+1]]+S[o[t+2]]+S[o[t+3]]+"-"+S[o[t+4]]+S[o[t+5]]+"-"+S[o[t+6]]+S[o[t+7]]+"-"+S[o[t+8]]+S[o[t+9]]+"-"+S[o[t+10]]+S[o[t+11]]+S[o[t+12]]+S[o[t+13]]+S[o[t+14]]+S[o[t+15]]).toLowerCase()}var G,$t=new Uint8Array(16);function jt(){if(!G&&(G=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!G))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return G($t)}var Ht=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ot={randomUUID:Ht};function Ft(o,t,n){if(ot.randomUUID&&!t&&!o)return ot.randomUUID();o=o||{};var e=o.random||(o.rng||jt)();if(e[6]=e[6]&15|64,e[8]=e[8]&63|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=e[i];return t}return Lt(e)}const Wt={class:"gutter-annotations"},Gt=["onClick"],zt={key:0},Jt={key:0,class:"gutter text"},qt={class:"content"},Qt=s.defineComponent({__name:"AnnotatedText",props:{componentId:{},text:{},annotations:{default:()=>[]},selectedAnnotations:{default:()=>[]},hoveredAnnotations:{default:()=>[]},lines:{default:()=>[]},annotationOffset:{default:0},debug:{type:Boolean,default:!1},verbose:{type:Boolean,default:!1},theme:{default:"default"},render:{default:"nested"},display:{default:"span"},showLabels:{type:Boolean,default:!1},autoAnnotationWeights:{type:Boolean,default:!0},style:{default:()=>({activeClass:"annotation--active",startClass:"annotation--start",endClass:"annotation--end",weightClass:"annotation--weight-",transitioningClass:"annotation--transitioning",shadowClass:"annotation--shadow",hoveredClass:"annotation--hover"})},allowEdit:{type:Boolean,default:!0},allowCreate:{type:Boolean,default:!0},listenToOnUpdateStart:{type:Boolean,default:!1},listenToOnUpdating:{type:Boolean,default:!1},listenToOnKeyPressed:{type:Boolean,default:!1},listenToOnCreateStart:{type:Boolean,default:!1},listenToOnCreating:{type:Boolean,default:!1}},emits:["annotation-select","annotation-update-begin","annotation-updating","annotation-update-end","annotation-create-begin","annotation-creating","annotation-create-end","key-pressed","annotation-mouse-over","annotation-mouse-leave","user-action-state-change"],setup(o,{emit:t}){let n=o;n=u.reactive(n);const e=t,i=Mt(n.componentId),{updateState:a,createState:p,userState:d,hoverState:g}=Bt(i()),f=u.computed(()=>d.value.state),h=new Ut(n,a.value,p.value),y=new pt(n,a.value),C=y.annotationGutterClasses,b=y.annotationClasses,B=y.componentClasses,M=y.wordPartClasses;s.watch(f,(r,v)=>{n.verbose&&console.log("user-action-state-change",v,r),e("user-action-state-change",v,r)}),window.addEventListener("keyup",r=>{if(n.listenToOnKeyPressed)n.verbose&&console.log("key-pressed",r.key,a.value,p.value),e("key-pressed",r,a.value,p.value,d.value);else switch(r.key){case"Escape":a.value.resetUpdate()}});const R=new Map,O=new Map,V=new Map;function F(r,v){n.verbose&&console.log("@onMouseDown","userState:",d.value.state,v),R.get(d.value.state)&&R.get(d.value.state)(r,v)}function x(r,v){var m;n.verbose&&console.log("@onMouseMove","userState:",r,d.value.state,v,(m=v==null?void 0:v.annotation)==null?void 0:m.id),V.get(d.value.state)&&V.get(d.value.state)(r,v)}function T(r){n.verbose&&console.log("@onMouseUp","userState:",d.value.state),O.get(d.value.state)&&O.get(d.value.state)(r)}function I(r,v){n.verbose&&console.log("@onMouseLeave","userState:",d.value.state),a.value.updating&&a.value.resetUpdate(),p.value.creating&&p.value.resetCreating()}return R.set(N.IDLE,(r,v)=>{if(v!=null&&v.annotation){d.value.state=N.START_SELECT,d.value.payload=v;return}if(v!=null&&v.startOffset){d.value.state=N.START_CREATE,d.value.payload=v;return}}),O.set(N.START_SELECT,r=>{n.verbose&&console.log("annotation-select",d.value.payload.annotation),e("annotation-select",d.value.payload.annotation,r),d.value.reset()}),O.set(N.START_CREATE,r=>{d.value.reset()}),V.set(N.START_CREATE,(r,v)=>{if(n.allowCreate){const m=v.startOffset+W(r.x,r.y).offset;if(p.value.startCreating(m),n.listenToOnCreateStart)n.verbose&&console.log("*emit annotation-create-begin",p.value),e("annotation-create-begin",p.value);else{const c={id:Ft(),start:p.value.newStart,end:p.value.newStart,class:"annotation annotation--color-1",target:"span",active:!0,visible:!0};p.value.initAnnotation(c)}d.value.state=N.CREATING}}),V.set(N.CREATING,(r,v)=>{const m=W(r.x,r.y);if(m){const c=v.startOffset+m.offset;p.value.newStart<=c&&(p.value.newEnd=c,n.listenToOnCreating?(n.verbose&&console.log("*emit annotation-creating",p.value),e("annotation-creating",p.value)):p.value.updateCreating())}}),O.set(N.CREATING,r=>{n.verbose&&console.log("*emit annotation-create-end",p.value),e("annotation-create-end",p.value),p.value.resetCreating()}),V.set(N.START_SELECT,(r,v)=>{if(!n.allowEdit)return;const m=W(r.x,r.y);m&&(a.value.startUpdating(d.value.payload.action,d.value.payload.startOffset+m.offset,d.value.payload.annotation,d.value.payload.annotation.end,d.value.payload.annotation.start,d.value.payload.annotation.end,d.value.payload.annotation.start),n.listenToOnUpdateStart?(n.verbose&&console.log("*emit annotation-update-begin",a.value),e("annotation-update-begin",a.value)):a.value.confirmStartUpdating())}),V.set(N.UPDATING,(r,v)=>{const m=W(r.x,r.y);let c=!1;if(m){const l=v.startOffset+m.offset,w=l-a.value.handlePosition;switch(a.value.newStart=a.value.annotation.start,a.value.newEnd=a.value.annotation.end,a.value.action){case"moveEnd":l>=a.value.annotation.start&&(a.value.newEnd=l,c=!0);break;case"moveStart":l<=a.value.annotation.end&&(a.value.newStart=l,c=!0);break;default:case"move":a.value.newStart!=a.value.origStart+w&&(a.value.newStart=a.value.origStart+w,a.value.newEnd=a.value.origEnd+w,c=!0);break}c&&(n.listenToOnUpdating?(n.verbose&&console.log("*emit annotation-updating",a.value),e("annotation-updating",a.value)):a.value.confirmUpdate())}}),O.set(N.UPDATING,r=>{n.verbose&&console.log("*emit annotation-update-end",a.value),e("annotation-update-end",a.value),a.value.resetUpdate()}),V.set(N.IDLE,(r,v)=>{if(v!=null&&v.annotation){const m=v.annotation;g.value.hoveredAnnotations.some(c=>c.id===m.id)||(g.value.hoveredAnnotations.push(m),n.verbose&&console.log("annotation-mouse-over",m.id),e("annotation-mouse-over",m,r))}else g.value.hoveredAnnotations.map(m=>{n.verbose&&console.log("annotation-mouse-leave",m.id),e("annotation-mouse-leave",m,r)}),g.value.hoveredAnnotations=[]}),(r,v)=>s.unref(h).annotatedLines?(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass(s.unref(B)),onMouseleave:v[0]||(v[0]=m=>I()),onMouseup:v[1]||(v[1]=m=>T(m))},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(s.unref(h).annotatedLines.value,m=>{var c;return s.openBlock(),s.createElementBlock(s.Fragment,{key:m},[s.createElementVNode("div",Wt,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(m.gutter.annotations,l=>(s.openBlock(),s.createElementBlock("span",{key:l,class:s.normalizeClass(s.unref(C)(l,m)),onClick:w=>F(w,{startOffset:0,annotation:l})},[l.label?(s.openBlock(),s.createElementBlock("label",zt,s.toDisplayString(l.label),1)):s.createCommentVNode("",!0)],10,Gt))),128))]),m!=null&&m.gutter?(s.openBlock(),s.createElementBlock("div",Jt,s.toDisplayString((c=m==null?void 0:m.gutter)==null?void 0:c.text),1)):s.createCommentVNode("",!0),s.createElementVNode("div",qt,[s.createVNode(bt,{"component-id":s.unref(n).componentId,line:m,"allow-edit":r.allowEdit,"allow-create":r.allowCreate,"annotation-classes":s.unref(b),"word-part-classes":s.unref(M),render:r.render,"mouse-down-handler":F,"mouse-move-handler":x},{"annotation-before":s.withCtx(l=>[s.renderSlot(r.$slots,"annotation-before",{annotation:l.annotation})]),"annotation-after":s.withCtx(l=>[s.renderSlot(r.$slots,"annotation-after",{annotation:l.annotation})]),_:2},1032,["component-id","line","allow-edit","allow-create","annotation-classes","word-part-classes","render"])])],64)}),128))],34)):s.createCommentVNode("",!0)}});exports.AnnotatedText=Qt;
